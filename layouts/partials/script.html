{{ $script := .link }}

{{ if .asset }}
{{ $buildConf := (dict "minify" false "target" "esnext") }}

{{ if hugo.IsProduction }}
{{ $buildConf = merge $buildConf (dict "minify" true) }}
{{ end }}

{{ $script = resources.Get $script | js.Build $buildConf }}
{{ end }}

{{ $fingerprint := "" }}

{{ if .asset }}
{{ if hugo.IsProduction }}
{{ $script = $script | minify }}
{{ end }}

{{ $fingerprint = $script | fingerprint }}
{{ $script = $script.Permalink }}
<script src="{{ $script | relURL }}" {{ if .async }}async{{ end }} {{ if .defer }}defer{{ end }} integrity="{{ $fingerprint.Data.Integrity }}" crossorigin="anonymous"></script>
{{ else }}
<script src="{{ $script | relURL }}" {{ if .async }}async{{ end }} {{ if .defer }}defer{{ end }} crossorigin="anonymous"></script>
{{ end }}