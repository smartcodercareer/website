{{ $organizationName := delimit (.Site.Params.Owner | lower | split " ") "" }}
{{ $organization := printf `%s#/schema/organization/%s` (.Site.baseURL | safeHTML) $organizationName }}
{{ $organizationURL := .Site.baseURL | safeHTML }}
{{ $logo := printf `%s#/schema/image/logo` .Site.baseURL | safeHTML }}
{{ $logoURL := "images/logo-oneliner.jpg" | absURL | safeHTML }}
{{ $logoCaption := printf "%s logo." .Site.Params.Title }}
{{ $website := printf "%s#/schema/website/%s" (.Site.baseURL | safeHTML) $organizationName }}
{{ $websiteURL := .Site.baseURL | safeHTML }}
{{ $websiteTitle := .Site.Title | safeJS }}
{{ $breadcrumb := printf "%s#/schema/breadcrumb/%s" (.Site.baseURL | safeHTML) $organizationName}}

{{ if or .IsHome .IsSection -}}
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@graph": [{
      "@type": "Organization"
      "@id": {{ $organization }},
      "brand": {{ $organizationName }},
      "url": {{ .Site.baseURL }},
      "logo": {
        "@type": "ImageObject",
        "@id": {{ $logo }},
        "url": {{ $logoURL }},
        "width": 180,
        "height": 36,
        "caption": {{ $logoCaption }}
      },
      "sameAs": [{{ range $i, $link := .Site.Params.social.fullLinks }}{{ if $i }}, {{ $link }}{{ end }}{{ end }}],
    }, {
      "@type": "WebSite",
      "@id": {{ $website }},
      "url": {{ $websiteURL }},
      "name": {{ $websiteTitle }},
      "publisher": {
        "@id": {{ $organization }}
      }
    }, {
      "@type": "WebPage",
      "@id": {{ .Permalink }},
      "url": {{ .Permalink }},
      "inLanguage": {{ .Site.LanguageCode | default "en-US" }},
      "name": "{{ .Site.Title | safeJS }}",
      "datePublished": "2020-12-15T08:13:22+00:00",
      "dateModified": "2020-12-15T21:54:07+00:00",
      "description": "{{ .Site.Params.Description }}",
      "isPartOf": {
        "@id": {{ $website }}
      },
      "about": {
        "@id": {{ $organization }}
      }
    }
      {{ if .Sections }}
             , {
               "@type": "BreadcrumbList",
               "@id": {{ $breadcrumb }},
               "itemListElement": [
                 {{ range $i, $item := .Sections }}
                 {
                   "@type": "ListItem",
                   "position": {{ add $i 1 }},
                   "item": {
                     "@type": "WebPage",
                     "@id": {{ $item.Permalink }},
                     "url": {{ $item.Permalink }},
                     "name": "{{ $item.Title | safeJS }}"
                   }
                 }
                 {{ end }}
               ]
             }
      {{ end }}
    ]
  }
</script>
{{ else if eq .Type "posts" }}
{{ $author :=  or .Params.author .Site.Author.name }}
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@graph": [{
      "@type": "Organization"
      "@id": {{ $organization }},
      "brand": {{ $organizationName }},
      "url": {{ .Site.baseURL }},
      "logo": {
        "@type": "ImageObject",
        "@id": {{ $logo }},
        "url": {{ $logoURL }},
        "width": 180,
        "height": 36,
        "caption": {{ $logoCaption }}
      },
      "image": {
        "@id": {{ printf "%s#/schema/image/%s" (.Permalink | safeHTML) (.Title | anchorize) }},
        "inLanguage": {{ .Site.LanguageCode | default "en-US" }},
        "url": "{{ index .Params.images 0 }}",
        "width": 719,
        "height": 405,
        "caption": {{ .Title }}
      },
      "sameAs": [{{ range $i, $link := .Site.Params.social.fullLinks }}{{ if $i }}, {{ $link }}{{ end }}{{ end }}],
    }, {
      "@type": "WebSite",
      "@id": {{ $website }},
      "url": {{ $websiteURL }},
      "name": {{ $websiteTitle }},
      "publisher": {
        "@id": {{ $organizationName }}
      }
    }, {
      "@type": "WebPage",
      "@id": {{ .Permalink }},
      "url": {{ .Permalink }},
      "inLanguage": {{ .Site.LanguageCode | default "en-US" }},
      "name": {{ $websiteTitle }},
      "datePublished": {{ .PublishDate }},
      "dateModified": {{ .Lastmod }},
      "description": {{ .Site.Params.Description }},
      "isPartOf": {
        "@id": {{ $organization }}
      },
      "about": {
        "@id": {{ $organization }}
      }
    }, {
      "@type": "BreadcrumbList",
      "@id": {{ $breadcrumb }},
      "itemListElement": [
        {{ range $i, $item := .Sections }}
        {
          "@type": "ListItem",
          "position": {{ add $i 1 }},
          "item": {
            "@type": "WebPage",
            "@id": "{{ $item.Permalink }}",
            "url": "{{ $item.Permalink }}",
            "name": "{{ $item.Title | safeJS }}"
          }
        }
        {{ end }}
      ]
    }, {
      "@type": "BlogPosting",
      "articleSection": "{{ .Section }}",
      "name": "{{ .Title | safeJS }}",
      "headline": "{{ .Title | safeJS }}",
      "description": "{{ if .Description }}{{ .Description | safeJS }}{{ else }}{{if .IsPage}}{{ .Summary  }}{{ end }}{{ end }}",
      "inLanguage": {{ .Site.LanguageCode | default "en-us" }},
      "isFamilyFriendly": "true",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": {{ .Permalink }}
      },
      "author" : {
        "@type": "Person",
        "name": "{{ $author }}"
      },
      "creator" : {
        "@type": "Person",
        "name": "{{ $author }}"
      },
      "accountablePerson" : {
        "@type": "Person",
        "name": "{{ $author }}"
      },
      "copyrightHolder": {{ $organizationName }},
      "copyrightYear": {{ now.Format "2006" }},
      "dateCreated": {{ .Date }},
      "datePublished": "{{ .PublishDate }}",
      "dateModified": "{{ .Lastmod }}",
      "publisher":{
        "@type": "Organization",
        "@id": {{ $organizationName }}
      },
      "image": {
        "@id": {{ printf "%s#/schema/image/%s" (.Permalink | safeHTML) (.Title | anchorize) }}
      },
      "url" : {{ .Permalink }},
      "wordCount" : "{{ .WordCount }}",
      "keywords" : [{{ delimit .Params.tags ", " }}]
    ]
  }]
  }
</script>
{{ else }}
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@graph": [{
      "@type": "Organization"
      "@id": {{ $organization }},
      "brand": {{ $organizationName }},
      "url": {{ $organizationURL}},
      "logo": {
        "@type": "ImageObject",
        "@id": {{ $logo }},
        "url": {{ $logoURL }},
        "width": 180,
        "height": 36,
        "caption": {{ $logoCaption }}
      },
      {{ with .Params.images }}
      "image": {
        "@id": {{ printf "%s#/schema/image/%s" (.Permalink | safeHTML) (.Title | anchorize) }},
        "inLanguage": {{ .Site.LanguageCode | default "en-US" }},
        "url": {{ (.Resources.GetMatch (index .Params.images 0)).Permalink }},
        "width": 719,
        "height": 405,
        "caption": "{{ .Title }}"
      },
      {{ end }}
      "sameAs": [{{ range $i, $link := .Site.Params.social.fullLinks }}{{ if $i }}, {{ $link }}{{ end }}{{ end }}],
    }, {
      "@type": "WebSite",
      "@id": {{ $website }},
      "url": {{ $websiteURL }},
      "name": "{{ .Site.Title | safeJS }}",
      "publisher": {
        "@id": {{ $organizationName }}
      }
    }, {
      "@type": "WebPage",
      "@id": {{ .Permalink }},
      "url": {{ .Permalink }},
      "inLanguage": {{ .Site.LanguageCode | default "en-US" }},
      "name": "{{ .Site.Title | safeJS }}",
      "datePublished": {{ .PublishDate }},
      "dateModified": {{ .Lastmod }},
      "description": "{{ .Description }}",
      "isPartOf": {
        "@id": {{ $organizationURL }}
      },
      "about": {
        "@id": {{ $organizationURL }}
      }
    }, {
      "@type": "BreadcrumbList",
      "@id": {{ $breadcrumb }},
      "itemListElement": [
        {{ range $i, $item := .Sections }}
        {
          "@type": "ListItem",
          "position": {{ add $i 1 }},
          "item": {
            "@type": "WebPage",
            "@id": "{{ $item.Permalink }}",
            "url": "{{ $item.Permalink }}",
            "name": "{{ $item.Title | safeJS }}"
          }
        }
        {{ end }}
      ]
    }]
  }
</script>
{{ end }}